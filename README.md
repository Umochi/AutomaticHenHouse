<h1>#AutomaticHenHouse</h1>
<h2>Progetto per automazione della porta di un pollaio.</h2>
<p>L'hardware che si occupa dell'apertura e chiusura della porta &egrave; costituito da una scheda <strong>Arduino Uno</strong>, collegata alla rete tramite un <strong>ethernet-shield</strong>.</p>
<p><img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/arduino_uno_main_board.jpg" alt="" width="200" height="200" /><img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/ethernet-shield.jpg" alt="Ethernet-Shield" width="200" /></p>
<hr />
<p>Il motore che esegue l'apertura della porta tramite una barra filettata &egrave; un semplice motore a 12v che monta un mandrino.</p>
<p><img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/IMG_4037.JPG" alt="" width="290" height="435" />&nbsp;&nbsp; <img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/IMG_4039.JPG" alt="" width="290" height="435" /><img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/IMG_4036.JPG" alt="" width="592" height="816" /></p>
<hr />
<p>Per interfacciarsi con il motore &egrave; stato utilizzato un <strong>diver lmd18200</strong>, ma potevano essere utilizzati anche 4 semplici relais. L'utilizzo di questo diver permette di comandare oltre alla direzione e all'attivit&agrave; del motore anche il voltaggio in uscita per regolare la velocit&agrave; di salita e discesa.</p>
<p><img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/IMG_4026.JPG" alt="" width="286" height="235" />&nbsp;&nbsp; <img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/IMG_4034.JPG" alt="" width="200" height="235" /></p>
<hr />
<p>Due semplici bottoni (PCB Switch) costituiscono il fine corsa per lo sportello in apertura e chiusura. Altri due bottoni dello stesso tipo costituiscono una tastiera aggiuntiva per forzare la chiusura e l'apertura senza dover utilizzare l'interfaccia web service.</p>
<p><img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/Push-Button.jpg" width="230" height="230" />&nbsp;&nbsp; <img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/IMG_4038.JPG" alt="" width="260" height="301" /></p>
<hr />
<p>L'interfaccia grafica e la gestione dell'automatizzazione della chiusura e apertura sono costituite da un applicazione <strong>Node-Red</strong>. In particolare la libreria <strong>node-red-dashboard</strong> fornisce i nodi necessari alla creazione dell'interfaccia grafica.</p>
<p>&nbsp;</p>
<p>&nbsp;<img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/IMG_4054.PNG" alt="" width="200" height="356" />&nbsp;&nbsp; <img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/IMG_4055.PNG" alt="" width="200" height="356" />&nbsp;&nbsp; <img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/IMG_4056.PNG" alt="" width="200" height="356" /></p>
<hr />
<p>La libreria: <strong>node-red-contrib-sun-position</strong> fornisce le funzionait&agrave; di schedulazioni con l'evento di alba e tramonto, relativo alla zona impostata.</p>
<p><img src="https://raw.githubusercontent.com/Umochi/AutomaticHenHouse/master/images/SchermataNodeRed.jpg" alt="" width="600" height="237" /></p>
<hr />
<p>In breve il comportamento del sistema è il seguente: il ciclo di arduino esgue un loop in cui controlla se sono presenti invocazioni sul servizio web esposto o pressione dei tasti. Il servizio web restituisce un json che riporta lo stato dei sensori di apertura e chiura e l'attività del motore. Inoltre vengono recuperati i comandi inviati come url parameters, questi possono essere il comando di Chiusura, Apertura e di Stop. Il comando di stop non viene però utilizzato all'interno della user interface esposta. Viene anche data possibilità di tarare l'energia utilizzata dal mototore in caso di necessità. Di base l'attivazione del motore viene eseguita al 100% del voltaggio disponibile, ma viene ridotta al 50% dopo un secondo. L'intera operazione di Apertura/Chiusura dura all'incirca 4 secondi. La riduzione di potenza è importate, non solo per ridurre la velocità e la possibilà di incidenti, ma per ridurre l'inerzia sul fine corsa e la possibilità di incastare il meccanismo e non avare uno spunto sufficiente a avviare l'operazione successiva. Alcuni ritardi condizionati nel ciclo sono stati introdotti per non sovracaricare Arduino.</p>
<p>Il Flow in Node-Red si occupa di generare l'interfaccia grafica e attivare le schedulazioni. In particolare, la user interface mostra lo stato della porta, chiusa, aperta o in stato intermedio e lo stato di attività del motore. Viene poi data lo possibilità di attivare o disattivare l'esecuzione anutomatica. Due bottoni danno invece la possibiltà di forzare chiusura e apertura.</p>
<p>Quando lo switch è impostato su Automatico, la schedulazione condizionata dalla posizione del sole nello stato di "Alba" e "Fine Tramonto" scatenano le operazioni di apertura e chiusura.</p>
